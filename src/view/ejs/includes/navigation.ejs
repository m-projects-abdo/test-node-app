<script type="module">
  let user_name = document.getElementById('user_name');
  let email = document.getElementById('email');
  let user = {};
  window.onload = async ()=> {
    let res = await fetch('http://localhost:3000/auth/login', {
      method: 'POST',
      body: JSON.stringify({
        email: "wss22wss222sss22@test.com",
        password: "test@2022"
      }),
      headers: {
        "Content-type": "application/json; charset=UTF-8"
      }
    });
    user = await res.json();
    localStorage.setItem('user', JSON.stringify(user.data));
    user_name.innerText = user.data.name;
    email.value = user.data.email;
    console.log(email.value);
  }

  user_name.addEventListener('click', async()=> {
    let payload = JSON.parse(localStorage.getItem('user'));
    await fetch('http://localhost:3000/profile', {
      method: 'POST',
      body: JSON.stringify({
        email: payload.email
      }),
      headers: {
        "Content-type": "application/json; charset=UTF-8"
      }
    });
  });
</script>

<header class="main-header">
  <nav class="main-header__nav">
    <ul class="main-header__item-list">
      <li class="main-header__item">
        <form action="/profile" method="POST">
          <input 
            type="hidden" 
            id="email" 
            name="email" 
            type="text"
          >
          <button 
            id="user_name"
            type="submit"
            class="<%= pagePath == '/profile' ? 'active' : '' %> user_button"
          ></button>
        </form>
      </li>
      <li class="main-header__item">
        <a 
          class="<%= pagePath == '/' ? 'active' : '' %>" 
          href="/"
        >Shop</a>
      </li>
      <li class="main-header__item">
        <a 
          class="<%= pagePath == '/admin/add-product' ? 'active' : '' %>" 
          href="/admin/add-product"
        >Add Product</a>
      </li>
    </ul>
  </nav>
</header>